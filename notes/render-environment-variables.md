# Render.com Environment Variables Reference

**Project:** Mining ERP System  
**Last Updated:** December 20, 2024

---

## üìã Overview

This document contains all environment variables needed for deploying the Mining ERP system on Render.com. Copy and paste these into your Render service configurations.

---

## üóÑÔ∏è Database Service

**Service Type:** PostgreSQL  
**Service Name:** `mining-erp-database`

### Configuration

- **Database Name:** `mining_erp`
- **User:** Auto-generated by Render
- **PostgreSQL Version:** 16
- **Region:** Choose closest to your users

### Connection URLs

After creation, Render provides:
- **Internal Database URL:** Used by backend (faster, private network)
- **External Database URL:** Used for local development/migrations

**Format:**
```
postgresql://[user]:[password]@[host]/[database]
```

**No additional environment variables needed for the database service itself.**

---

## üîß Backend Service (NestJS API)

**Service Type:** Web Service  
**Service Name:** `mining-erp-backend`  
**Root Directory:** `dev/backend`

### Required Environment Variables

```bash
# ============================================
# DATABASE CONFIGURATION
# ============================================
# IMPORTANT: Use the INTERNAL Database URL from your Render PostgreSQL service
DATABASE_URL=postgresql://mining_erp_user:xxxxx@dpg-xxxxx/mining_erp
DIRECT_URL=postgresql://mining_erp_user:xxxxx@dpg-xxxxx/mining_erp

# ============================================
# APPLICATION CONFIGURATION
# ============================================
PORT=10000
NODE_ENV=production

# ============================================
# FRONTEND CORS CONFIGURATION
# ============================================
# Update this after deploying frontend
FRONTEND_URL=https://mining-erp-frontend.onrender.com
FRONTEND_URLS=https://mining-erp-frontend.onrender.com

# ============================================
# JWT AUTHENTICATION
# ============================================
# CRITICAL: Change this to a strong random string (min 32 characters)
# Generate with: openssl rand -base64 32
JWT_SECRET=CHANGE-THIS-TO-A-STRONG-RANDOM-STRING-MIN-32-CHARS
JWT_EXPIRATION=7d

# ============================================
# FILE STORAGE CONFIGURATION
# ============================================
STORAGE_PROVIDER=local
LOCAL_STORAGE_PATH=./uploads
MAX_FILE_SIZE=10485760

# ============================================
# PHASE 16.5: DOCUMENT TO PDF CONVERSION
# ============================================
CONVERSION_WORKER_ENABLED=true
CONVERSION_WORKER_CONCURRENCY=2
CONVERSION_WORKER_STUCK_MINUTES=30

# Optional (Office/HTML conversion via CloudConvert)
# Requires STORAGE_PROVIDER=s3
# CLOUDCONVERT_API_KEY=your_cloudconvert_api_key

# For AWS S3 Storage (Optional - if you want cloud storage)
# STORAGE_PROVIDER=s3
# AWS_REGION=us-east-1
# AWS_ACCESS_KEY_ID=your_access_key
# AWS_SECRET_ACCESS_KEY=your_secret_key
# AWS_S3_BUCKET=your-bucket-name

# ============================================
# EMAIL CONFIGURATION (Optional)
# ============================================
# Uncomment and configure if you want email notifications
# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_SECURE=false
# SMTP_USER=your-email@example.com
# SMTP_PASSWORD=your-app-specific-password
# SMTP_FROM=noreply@miningerp.com

# ============================================
# AI CONFIGURATION (Optional)
# ============================================
# Uncomment if you want to enable AI features
# OPENAI_API_KEY=sk-your-openai-api-key-here
# CLAUDE_API_KEY=your-claude-api-key-here

# ============================================
# LOGGING & MONITORING (Optional)
# ============================================
# LOG_LEVEL=info
# SENTRY_DSN=your-sentry-dsn-for-error-tracking
```

### Build & Start Commands

```bash
# Build Command
npm install && npm run build

# Start Command
npm run start:prod
```

---

## üé® Frontend Service (Next.js)

**Service Type:** Web Service  
**Service Name:** `mining-erp-frontend`  
**Root Directory:** `dev/frontend`

### Required Environment Variables

```bash
# ============================================
# BACKEND API CONFIGURATION
# ============================================
# Update with your actual backend URL after backend deployment
BACKEND_URL=https://mining-erp-backend.onrender.com
NEXT_PUBLIC_API_URL=https://mining-erp-backend.onrender.com/api

# ============================================
# APPLICATION CONFIGURATION
# ============================================
NODE_ENV=production
PORT=3000

# ============================================
# NEXT.JS CONFIGURATION (Optional)
# ============================================
# NEXT_TELEMETRY_DISABLED=1
```

### Build & Start Commands

```bash
# Build Command
npm install && npm run build

# Start Command
npm start
```

---

## üîê Security Best Practices

### JWT Secret Generation

Generate a strong JWT secret:

```bash
# Using OpenSSL (Linux/Mac)
openssl rand -base64 32

# Using Node.js
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"

# Using PowerShell (Windows)
[Convert]::ToBase64String((1..32 | ForEach-Object { Get-Random -Minimum 0 -Maximum 256 }))
```

### Environment Variable Security

- ‚úÖ **DO:** Use Render's encrypted environment variables
- ‚úÖ **DO:** Change all default/example values
- ‚úÖ **DO:** Use different secrets for dev/staging/production
- ‚ùå **DON'T:** Commit `.env` files to Git
- ‚ùå **DON'T:** Share credentials in plain text
- ‚ùå **DON'T:** Use weak or predictable secrets

---

## üîÑ Environment Variable Updates

### How to Update Variables

1. Go to your service in Render Dashboard
2. Click **"Environment"** tab
3. Edit or add variables
4. Click **"Save Changes"**
5. Service will automatically redeploy

### When to Update

**Backend Variables:**
- After frontend deployment (update FRONTEND_URL)
- When adding custom domains
- When enabling new features (AI, email, etc.)

**Frontend Variables:**
- After backend deployment (update BACKEND_URL)
- When adding custom domains

---

## üåê Custom Domain Configuration

### Backend with Custom Domain

If using `api.yourdomain.com`:

```bash
# Update backend environment
FRONTEND_URL=https://app.yourdomain.com
FRONTEND_URLS=https://app.yourdomain.com,https://yourdomain.com
```

### Frontend with Custom Domain

If using `app.yourdomain.com`:

```bash
# Update frontend environment
BACKEND_URL=https://api.yourdomain.com
NEXT_PUBLIC_API_URL=https://api.yourdomain.com/api
```

---

## üß™ Testing Environment Variables

### Test Backend Configuration

```bash
# SSH into backend service shell
# Check if variables are loaded
echo $DATABASE_URL
echo $JWT_SECRET
echo $FRONTEND_URL

# Test database connection
npx prisma db pull

# Test API
curl http://localhost:10000/api
```

### Test Frontend Configuration

```bash
# SSH into frontend service shell
# Check if variables are loaded
echo $NEXT_PUBLIC_API_URL
echo $BACKEND_URL

# Test build
npm run build
```

---

## üìù Environment Variable Checklist

### Before Deploying Backend

- [ ] DATABASE_URL is set to Internal Database URL
- [ ] DIRECT_URL is set to Internal Database URL
- [ ] JWT_SECRET is changed from default (min 32 chars)
- [ ] PORT is set to 10000
- [ ] NODE_ENV is set to production
- [ ] FRONTEND_URL will be updated after frontend deployment

### Before Deploying Frontend

- [ ] BACKEND_URL is set to your backend service URL
- [ ] NEXT_PUBLIC_API_URL is set to backend API endpoint
- [ ] NODE_ENV is set to production

### After Both Deployed

- [ ] Update backend FRONTEND_URL with actual frontend URL
- [ ] Test CORS by accessing frontend and making API calls
- [ ] Verify authentication works
- [ ] Test file uploads (if using document management)

---

## üîç Troubleshooting

### "Database connection failed"

**Check:**
- Using INTERNAL Database URL (not external)
- Database service is running
- Connection string format is correct
- No extra spaces in DATABASE_URL

### "CORS error" in browser

**Check:**
- FRONTEND_URL in backend matches exact frontend URL
- Include `https://` protocol
- No trailing slash
- Backend service redeployed after updating FRONTEND_URL

### "JWT malformed" or "Invalid token"

**Check:**
- JWT_SECRET is same across all backend instances
- JWT_SECRET is at least 32 characters
- No special characters causing issues
- Token not expired (check JWT_EXPIRATION)

### "Cannot find module" errors

**Check:**
- All dependencies in package.json
- Build command includes `npm install`
- No missing peer dependencies
- Node version compatibility (use Node 18+)

---

## üìö Additional Resources

- **Render Environment Variables Docs:** https://render.com/docs/environment-variables
- **Render PostgreSQL Docs:** https://render.com/docs/databases
- **Next.js Environment Variables:** https://nextjs.org/docs/basic-features/environment-variables
- **NestJS Configuration:** https://docs.nestjs.com/techniques/configuration

---

## üÜò Quick Reference

### Get Database URL

1. Go to Render Dashboard
2. Click on `mining-erp-database`
3. Copy **Internal Database URL**
4. Paste into backend `DATABASE_URL`

### Get Backend URL

1. Go to Render Dashboard
2. Click on `mining-erp-backend`
3. Copy URL at top (e.g., `https://mining-erp-backend.onrender.com`)
4. Paste into frontend `BACKEND_URL`
5. Add `/api` for `NEXT_PUBLIC_API_URL`

### Update CORS After Frontend Deploy

1. Deploy frontend first
2. Copy frontend URL
3. Go to backend service ‚Üí Environment
4. Update `FRONTEND_URL` with frontend URL
5. Save (triggers redeploy)

---

**Last Updated:** December 20, 2024  
**Maintained By:** Mining ERP Team
